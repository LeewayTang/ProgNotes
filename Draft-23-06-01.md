> 这个讲稿是为23/06/01的技术分享准备的  
文档地址：[ns-3下搭建网络仿真](https://rg975ojk5z.feishu.cn/wiki/HpG6wgn5OiRHixkbLiBckksMn0e)

# 0

实习期的主要工作是做 ZCC 的复现工具，具体说就是把接收的流量保存为PCAP后，可以用这个工具得到 ZCC 的反应数据。

复现的过程是在ns-3这个网络模拟器下实现的，下面分享的内容也就是结合我的开发过程讲一讲ns-3这个工具。

# 1

**离散事件驱动**

ns-3有一个调度器按照时间顺序调度网络事件；仿真的时间也是离散的，当事件改变的时候“仿真时间“才会流动。从架构上说，ns-3实现了事件队列，然后用Simulator类来调度事件队列，用Scheduler类来修改事件队列。

**核心概念**

可以结合OSI分层模型来理解ns-3里的这些概念。节点是物理层的载体；设备是链路层，和信道直接产生交流；协议栈实现了网络层和传输层，也就是TCP/IP；应用就是应用层协议。使用ns-3的时候，这些概念对应的对象就是代码的主体。

**Helper**

上面这些概念还是比较繁杂，而且实际使用的时候复用性很强。ns-3提供了很多helper类，封装了常用的过程，目的是帮助使用者快速搭建ns-3的网络场景。一般来说，只要是比较通用的场景，都只需要用helper就可以完成。

**配置系统**


Config::SetDefault()：这个方法用于设置某个类型的对象的默认属性值

Config::Set()：这个方法用于设置某个具体的对象的属性值

Config::Connect()：这个方法用于连接某个对象的信号和槽，实现事件驱动编程

**属性系统**

要使用属性系统，一个类必须从ns3::Object或ns3::ObjectBase派生，并且实现一个静态的GetTypeId方法，该方法返回一个TypeId对象，该对象包含了关于该类的元信息。

# 2

快速上手ns-3的一些要点。

ns-3的特点是模块化，使用ns-3的过程也可以概括为：实现模块+使用模块（写脚本）。

写脚本比较套路，而且有大量案例可以参照。

写模块复杂一点，一个模块就是src目录下的一个子目录。

... ...

# 3

pcap-webrtc 就是实现前面说的复现功能的模块。
 
... ...

**仿真场景设计**

p2p-demo.cc中使用pcap-webrtc模块搭建的场景如图所示。它和前面提到的那个基本模型是直接对应的，用的是一个P2P的场景，然后模拟网络流量的收发过程。

... ...