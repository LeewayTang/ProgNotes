# 可重定位目标文件 *.o
`.o`文件是一种可重定位目标文件，它包含了一些函数和变量的二进制代码和符号表，以及一些重定位信息。.o文件可以被链接器链接成可执行文件或库文件。
```
+-----------------+
| ELF Header      |  // 存储.o文件的元数据，如类型，大小，入口点，段表等
+-----------------+
| Section Header  |  // 存储节头表，描述节在文件中的位置和属性
+-----------------+
| Text Section    |  // 存储代码段，包含函数的二进制指令
+-----------------+
| Data Section    |  // 存储数据段，包含全局变量和静态变量的值
+-----------------+
| BSS Section     |  // 存储未初始化的数据段，包含全局变量和静态变量的占位符
+-----------------+
| Relocation      |  // 存储重定位信息，描述代码和数据在内存中的地址
+-----------------+
| Symbol Table    |  // 存储符号表，描述函数和变量的名称和位置
+-----------------+
```
从CPP源码文件到`.o`文件的过程：
- 预处理。预处理器（cpp.exe）会处理#include和#define等指令，将头文件包含进来，将宏展开，生成一个.i文件。
- 编译。编译器（g++.exe）会将.i文件转换成汇编语言，生成一个.s文件。
- 汇编。汇编器（as.exe）会将.s文件转换成机器指令，生成一个.o文件。


# 静态库文件 *.a
```
+-----------------+
| Archive Header  |  // 存储库文件的元数据，如文件名，大小，时间戳等
+-----------------+
| Object File 1   |  // 存储第一个可重定位目标文件的内容，如代码段，数据段，符号表等
+-----------------+
| Object File 2   |  // 存储第二个可重定位目标文件的内容
+-----------------+
| ...             |
+-----------------+
| Object File N   |  // 存储第N个可重定位目标文件的内容
+-----------------+
```

这些Object File是从一个个`.o`文件中复制来的，Archive Header就是一张索引表。

# 动态库文件 *.so

```
+-----------------+
| ELF Header      |  // 存储动态库文件的元数据，如类型，大小，入口点，段表等
+-----------------+
| Program Header  |  // 存储程序头表，描述程序在内存中的布局和加载方式
+-----------------+
| Section Header  |  // 存储节头表，描述节在文件中的位置和属性
+-----------------+
| Text Section    |  // 存储代码段，包含函数的二进制指令
+-----------------+
| Data Section    |  // 存储数据段，包含全局变量和静态变量的值
+-----------------+
| BSS Section     |  // 存储未初始化的数据段，包含全局变量和静态变量的占位符
+-----------------+
| Relocation      |  // 存储重定位信息，描述代码和数据在内存中的地址
+-----------------+
| Symbol Table    |  // 存储符号表，描述函数和变量的名称和位置
+-----------------+
| Dynamic         |  // 存储动态链接信息，描述动态库的依赖关系和加载方式
+-----------------+
```
当链接器将多个.o文件链接成一个动态库文件时，它会将每个.o文件中的代码段和数据段合并成一个大的代码段和数据段，并将每个.o文件中的符号表合并成一个大的符号表。同时，它会生成程序头表和动态链接信息，来描述动态库文件在内存中的布局和加载方式，以及动态库文件的依赖关系和加载方式。
- Program Header是一种存储动态库文件在内存中的布局和加载方式的结构，它包含了一些信息，如段的类型，大小，位置等。Program Header可以让操作系统知道如何将动态库文件加载到内存中，并为其分配合适的权限。
- Dynamic是一种存储动态库文件的依赖关系和加载方式的结构，它包含了一些信息，如需要的其他动态库文件的名称和位置，导出和导入的符号的名称和位置等。Dynamic可以让动态链接器知道如何将动态库文件和可执行文件以及其他动态库文件链接起来，并解决符号的引用。